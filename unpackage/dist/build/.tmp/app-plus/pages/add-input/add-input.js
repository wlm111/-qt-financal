(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/add-input/add-input"],{"42f6":function(t,i,n){"use strict";n.r(i);var e=n("62c6"),s=n("6af2");for(var a in s)"default"!==a&&function(t){n.d(i,t,function(){return s[t]})}(a);n("8530");var r,o=n("f0c5"),c=Object(o["a"])(s["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],r);i["default"]=c.exports},4479:function(t,i,n){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e=s(n("a34a"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t,i){return c(t)||o(t,i)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,i){var n=[],e=!0,s=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if(n.push(r.value),i&&n.length===i)break}catch(c){s=!0,a=c}finally{try{e||null==o["return"]||o["return"]()}finally{if(s)throw a}}return n}function c(t){if(Array.isArray(t))return t}function u(t,i,n,e,s,a,r){try{var o=t[a](r),c=o.value}catch(u){return void n(u)}o.done?i(c):Promise.resolve(c).then(e,s)}function l(t){return function(){var i=this,n=arguments;return new Promise(function(e,s){var a=t.apply(i,n);function r(t){u(a,e,s,r,o,"next",t)}function o(t){u(a,e,s,r,o,"throw",t)}r(void 0)})}}var p=["仅自己可见","所有人可见"],d=function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"9232"))},h=function(){return n.e("components/common/uploud-images").then(n.bind(null,"8e1a"))},f={components:{uniNavBar:d,uploudImages:h},data:function(){return{isget:!1,showpopup:!0,yinsi:1,text:"",imglist:[],imglistIds:[],postclass:{id:0,title:"",range:[],list:[]},topic:{id:0,title:""}}},onBackPress:function(){if(this.text||!(this.imglist.length<1))return this.isget?void 0:(this.baocun(),!0)},computed:{getType:function(){return p[this.yinsi]}},onLoad:function(i){var n=this,e=t.getStorageSync("addinput");e&&(e=JSON.parse(e),this.yinsi=e.yinsi,this.imglistIds=e.imglistIds||[],this.imglistIds.length&&(this.imglist=e.imglist),this.text=e.text,e.postclass&&(this.postclass=e.postclass),e.topic&&(this.topic=e.topic));var s=!!i.postclass&&JSON.parse(i.postclass);this.getPostClass(s),t.$on("changeTopic",function(t){n.topic.id=t.id,n.topic.title="#".concat(t.title,"#")})},methods:{changeTopic:function(){t.navigateTo({url:"/pages/topic-nav/topic-nav?ischange="+!0})},getPostClass:function(){var t=l(e.default.mark(function t(i){var n,s,r,o,c,u,l,p,d,h;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!i){t.next=5;break}for(this.postclass.list=i,n=[],s=0;s<i.length;s++)n.push(i[s].name);return t.abrupt("return",this.postclass.range=n);case 5:return t.prev=5,t.next=8,this.$http.get("/postclass");case 8:if(r=t.sent,o=a(r,2),c=o[0],u=o[1],this.$http.errorCheck(c,u)){t.next=14;break}return t.abrupt("return");case 14:for(l=u.data.data.list,p=[],d=[],h=0;h<l.length;h++)p.push(l[h].classname),d.push({id:l[h].id,name:l[h].classname});this.postclass.range=p,this.postclass.list=d,t.next=24;break;case 21:return t.prev=21,t.t0=t["catch"](5),t.abrupt("return");case 24:case"end":return t.stop()}},t,this,[[5,21]])}));function i(i){return t.apply(this,arguments)}return i}(),changePostClass:function(t){this.postclass.id=this.postclass.list[t.target.value].id,this.postclass.title=this.postclass.list[t.target.value].name},baocun:function(){var i=this;t.showModal({content:"是否要保存为草稿？",cancelText:"不保存",confirmText:"保存",success:function(n){if(n.confirm){var e={yinsi:i.yinsi,text:i.text,imglist:i.imglist,imglistIds:i.imglistIds,postclass:i.postclass,topic:i.topic};t.setStorageSync("addinput",JSON.stringify(e))}else t.removeStorage({key:"addinput"});i.isget=!0,t.navigateBack({delta:1})}})},back:function(){t.navigateBack({delta:1})},submit:function(){var i=l(e.default.mark(function i(){var n,s,r,o;return e.default.wrap(function(i){while(1)switch(i.prev=i.next){case 0:if(this.postclass.id){i.next=2;break}return i.abrupt("return",t.showToast({title:"请选择分类",icon:"none"}));case 2:return t.showLoading({title:"发布中...",mask:!0}),i.prev=3,i.next=6,this.$http.post("/post/create",{imglist:JSON.stringify(this.imglistIds),text:this.text,isopen:this.yinsi,topic_id:this.topic.id,post_class_id:this.postclass.id},{token:!0,checkToken:!0,checkAuth:!0});case 6:if(n=i.sent,s=a(n,2),r=s[0],o=s[1],this.$http.errorCheck(r,o)){i.next=12;break}return i.abrupt("return",t.hideLoading());case 12:t.hideLoading(),t.showToast({title:"发布成功！"}),this.isget=!0,t.$emit("updateData",{type:"updateList",data:o.data.data.detail}),t.navigateBack({delta:1}),i.next=22;break;case 19:return i.prev=19,i.t0=i["catch"](3),i.abrupt("return");case 22:case"end":return i.stop()}},i,this,[[3,19]])}));function n(){return i.apply(this,arguments)}return n}(),changelook:function(){var i=this;t.showActionSheet({itemList:p,success:function(t){i.yinsi=t.tapIndex}})},upload:function(t){this.imglist.push(t.url),this.imglistIds.push({id:t.id})},delImageList:function(t){this.imglist.splice(t,1),this.imglistIds.splice(t,1)}}};i.default=f}).call(this,n("6e42")["default"])},5445:function(t,i,n){},"62c6":function(t,i,n){"use strict";var e,s=function(){var t=this,i=t.$createElement;t._self._c},a=[];n.d(i,"b",function(){return s}),n.d(i,"c",function(){return a}),n.d(i,"a",function(){return e})},"6af2":function(t,i,n){"use strict";n.r(i);var e=n("4479"),s=n.n(e);for(var a in e)"default"!==a&&function(t){n.d(i,t,function(){return e[t]})}(a);i["default"]=s.a},8530:function(t,i,n){"use strict";var e=n("5445"),s=n.n(e);s.a},c020:function(t,i,n){"use strict";(function(t){n("1133"),n("921b");e(n("66fd"));var i=e(n("42f6"));function e(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,n("6e42")["createPage"])}},[["c020","common/runtime","common/vendor"]]]);